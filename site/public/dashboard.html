<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PUBG | ESPORTS</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <script src="js/dashboard.js"></script>
    <script type="text/javascript" src="https://www.chartjs.org/dist/2.8.0/Chart.min.js"></script>

</head>

<body onload="validarSessao()">

    <div class="janela">
        <div class="header-left">

            <div class="hello">
                <h1>PUBG</h1>
            </div>

            <div class="btn-nav-white">
                <a href="./menu.html">
                    <h3>Perfil</h3>
                </a>
            </div>

            <div class="btn-nav">
                <a href="./dashboard.html"></a>
                <h3>Votação</h3>

            </div>

            <div class="btn-nav-white">
                <a href="./publicacoes.html">
                    <h3>Publicações</h3>
                </a>
            </div>

            <div class="btn-logout" onclick="limparSessao()">
                <h3>Sair</h3>
            </div>

        </div>
    </div>
    <div class="dash">
        <div class="votacaoDash">
            <div class="graficoUm">
                <canvas id="grafico1"></canvas>
            </div>
            <div class="graficoUm">
                <canvas id="grafico2"></canvas>
            </div>
            <div class="textoElenco">
                <h1>Times e Elencos</h1>
            </div>
            <div class="elencos">
                <div class="separarEmDois">
                    <img src="img/times/alemanha.png">
                    <img src="img/times/argentina.jpg">
                </div>
                <div class="separarEmDois">
                    <img src="img/times/australia.jpg">
                    <img src="img/times/brasil.jpg">
                </div>
                <div class="separarEmDois">
                    <img src="img/times/china.jpg">
                    <img src="img/times/chineseTaipe.png">
                </div>
                <div class="separarEmDois">
                    <img src="img/times/Eua.jpg">
                    <img src="img/times/finlandia.png">
                </div>
                <div class="separarEmDois">
                    <img src="img/times/indonesia.png">
                    <img src="img/times/inglaterra.png">
                </div>
                <div class="separarEmDois">
                    <img src="img/times/japao.jpg">
                    <img src="img/times/koreia.png">
                </div>
                <div class="separarEmDois">
                    <img src="img/times/tailandia.jpg">
                    <img src="img/times/turquia.png">
                </div>
                <div class="separarEmDois">
                    <img src="img/times/canada.png">
                    <img src="img/times/vietnam.png">
                </div>
            </div>
            <hr>
            <div class="areaDoVoto">
                <h1>Vote no seu time favorito</h1>
                <!-- <label for="inputVoto">Votar</label><br> -->
                <select id="selectVoto">
                    <option value="1">Brasil</option>
                    <option value="2">Canada</option>
                    <option value="3">Argentina</option>
                    <option value="4">EUA</option>
                    <option value="5">Australia</option>
                    <option value="6">China</option>
                    <option value="7">Finlândia</option>
                    <option value="8">Alemanha</option>
                    <option value="9">Indonésia</option>
                    <option value="10">Japão</option>
                    <option value="11">Coreia</option>
                    <option value="12">Tailândia</option>
                    <option value="13">Turquia</option>
                    <option value="14">Inglaterra</option>
                    <option value="15">Vietnam</option>
                    <option value="16">Chinese Taipe</option>
                </select>
                <button onclick="confirmarVoto()">Votar</button>
            </div>
        </div>
    </div>


</body>

</html> 
<script>

window.onload= obterDadosGrafico()

// function puxarVoto() {
//     fetch("/usuarios/puxarVoto").then(function (resposta) {
//         if (resposta.ok) {
    
//             resposta.json().then(function (resposta) {
//                 console.log("Dados recebidos: ", JSON.stringify(resposta));
                
//     plotarGrafico()
//             });
//         } else {
//             throw ('Houve um erro na API!');
//         }
//     }).catch(function (resposta) {
//         console.error(resposta);
//     });
// }

function obterDadosGrafico() {


    fetch(`/usuarios/puxarVoto`, { cache: "no-store" })
      .then(function (response) {
        if (response.ok) {
          response.json().then(function (resposta) {
            console.log("Dados recebidos: ", resposta);
            resposta.reverse();

            plotarGrafico(resposta);
          });
        } else {
          console.error("Nenhum dado encontrado ou erro na API");
        }
      })
      .catch(function (error) {
        console.error(
          `Erro na obtenção dos dados p/ gráfico: ${error.message}`
        );
      });
  }
function plotarGrafico(resposta) {
        console.log('iniciando plotagem do gráfico...');

        var dados = {
            labels: [],
            datasets: [
                {
                    label: 'Quantidade de votos',
                    backgroundColor: '#32b9cd8f',
                    data: []
                },
            ]
        };

        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            if (registro.time == "Australia") {
            dados.datasets[0].data.push(registro.voto);
        }
        // dados.labels.data.push(registro.nome);
    }

        console.log(JSON.stringify(dados));

        var ctx = document.getElementById("grafico1").getContext('2d');
        window.grafico_linha = Chart.Bar(ctx, {
            data: dados,
            options: {
                responsive: true,
                animation: { duration: 500 },
                hoverMode: 'index',
                stacked: false,
                title: {
                    display: false,
                    text: 'Dados capturados'
                },
                scales: {
                    yAxes: [{
                        type: 'linear',
                        display: true,
                        position: 'left',
                        id: 'y-temperatura',
                        ticks: {
                            beginAtZero: true,
                            max: 100,
                            min: 0
                        }
                    }, {
                        type: 'linear',
                        display: false,
                        position: 'right',
                        id: 'y-umidade',
                        ticks: {
                            beginAtZero: true,
                            max: 100,
                            min: 0
                        },

                        gridLines: {
                            drawOnChartArea: false,
                        },
                    }],
                }
            }
        });
    }


//     const labels = [
//       'Miramar',
//       'Erangel',
//       'Sanhok',
//       'Vikendi',
//       'Taego',
//     ];

//     const labels2 = [
//       'Brasil',
//       'Canada',
//       'Argentina',
//       'Eua',
//       'Australia',
//       'China',
//       'Finlandia',
//       'Alemanha',
//       'Indonesia',
//       'Japão',
//       'Coreia do sul',
//       'Tailândia',
//       'Turquia',
//       'Inglaterra',
//       'Vietnam',
//       'Nações unidas',
//     ];
  
//     const data = {
//       labels: labels,
//       datasets: [{
//         label: 'Quantidade de jogadores escolheram esse mapa',
//         backgroundColor: '#3d77ec',
//         borderColor: '#3d77ec',
//         data: [30, 32, 21, 5, 9],
//       }]
//     };


   
    
//     const data2 = {
//       labels: labels2,
//       datasets: [{
//         label: 'Quantidade de votos',
//         backgroundColor: '#3d77ec',
//         borderColor: '#3d77ec',
//         data: [43, 20, 6, 50, 12, 32, 4, 14, 7, 28, 50, 2, 6, 17, 22, 4],
//       }]
//     };
  
//     const config = {
//       type: 'bar',
//       data: data,
//       options: {}
//     };

//     const config2 = {
//       type: 'bar',
//       data: data2,
//       options: {}
//     };
//   </script>

// <script>
//     const grafico1 = new Chart(
//       document.getElementById('grafico1'),
//       config
//     );

//     const grafico2 = new Chart(
//       document.getElementById('grafico2'),
//       config2
//     );
// </script>